# UCMFH è®­ç»ƒæµ‹è¯•å®Œæ•´æµç¨‹ - ä¿®æ”¹å‰åå¯¹æ¯”

## ğŸ“š ç›®å½•
1. [æ•´ä½“æµç¨‹æ¦‚è§ˆ](#æ•´ä½“æµç¨‹æ¦‚è§ˆ)
2. [æ•°æ®åŠ è½½é˜¶æ®µ](#æ•°æ®åŠ è½½é˜¶æ®µ)
3. [æ¨¡å‹åˆå§‹åŒ–é˜¶æ®µ](#æ¨¡å‹åˆå§‹åŒ–é˜¶æ®µ)
4. [è®­ç»ƒé˜¶æ®µè¯¦è§£](#è®­ç»ƒé˜¶æ®µè¯¦è§£)
5. [æµ‹è¯•è¯„ä¼°é˜¶æ®µ](#æµ‹è¯•è¯„ä¼°é˜¶æ®µ)
6. [ä¿®æ”¹å‰åå¯¹æ¯”æ€»ç»“](#ä¿®æ”¹å‰åå¯¹æ¯”æ€»ç»“)

---

## æ•´ä½“æµç¨‹æ¦‚è§ˆ

### ğŸ¯ UCMFHåšä»€ä¹ˆï¼Ÿ
è·¨æ¨¡æ€å“ˆå¸Œæ£€ç´¢ï¼šç”¨å›¾ç‰‡æ‰¾æ–‡å­—ï¼Œæˆ–ç”¨æ–‡å­—æ‰¾å›¾ç‰‡

### ğŸ“Š ä¸¤é˜¶æ®µè®­ç»ƒç­–ç•¥
```
é˜¶æ®µ1 (task=0): è®­ç»ƒèåˆTransformer â†’ å­¦ä¹ å®å€¼åµŒå…¥
              â†“
é˜¶æ®µ2 (task=1): è®­ç»ƒå“ˆå¸Œå‡½æ•° â†’ å°†å®å€¼å‹ç¼©æˆäºŒè¿›åˆ¶å“ˆå¸Œç 
```

### ğŸ”„ å®Œæ•´æµç¨‹å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. å¯åŠ¨è®­ç»ƒ (demo.py)                                    â”‚
â”‚    python demo.py --task 0/1 --dataset mirflickr       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. åŠ è½½æ•°æ® (load_dataset.py)                           â”‚
â”‚    â”œâ”€ è®­ç»ƒé›†: 4,992å¯¹å›¾æ–‡ (batch_size=128 â†’ 39 batches)â”‚
â”‚    â”œâ”€ æŸ¥è¯¢é›†: ç”¨äºæµ‹è¯•                                   â”‚
â”‚    â””â”€ æ£€ç´¢é›†: ç”¨äºæµ‹è¯•                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. åˆå§‹åŒ–æ¨¡å‹ (ICMR.py __init__)                        â”‚
â”‚    â”œâ”€ ImageTransformer: å›¾åƒç‰¹å¾å¢å¼º                     â”‚
â”‚    â”œâ”€ TextTransformer: æ–‡æœ¬ç‰¹å¾å¢å¼º                      â”‚
â”‚    â”œâ”€ CrossAttention: è·¨æ¨¡æ€èåˆ                         â”‚
â”‚    â”œâ”€ ImageMlp: å›¾åƒå“ˆå¸Œæ˜ å°„                            â”‚
â”‚    â”œâ”€ TextMlp: æ–‡æœ¬å“ˆå¸Œæ˜ å°„                             â”‚
â”‚    â””â”€ ğŸ†• ContrastiveLoss: å¯¹æ¯”å­¦ä¹ æŸå¤±å‡½æ•°              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. è®­ç»ƒå¾ªç¯ (æ¯ä¸ªepoch)                                 â”‚
â”‚    For epoch in range(total_epochs):                   â”‚
â”‚        â”œâ”€ å‰å‘ä¼ æ’­ (ä¸€ä¸ªbatchçš„è¯¦ç»†è¿‡ç¨‹è§ä¸‹æ–¹)          â”‚
â”‚        â”œâ”€ è®¡ç®—æŸå¤± â­ è¿™é‡Œæ˜¯ä¿®æ”¹çš„å…³é”®ï¼                â”‚
â”‚        â”œâ”€ åå‘ä¼ æ’­                                       â”‚
â”‚        â””â”€ æ›´æ–°å‚æ•°                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. æµ‹è¯•è¯„ä¼° (æ¯10ä¸ªepoch)                               â”‚
â”‚    â”œâ”€ ç”ŸæˆæŸ¥è¯¢é›†çš„å“ˆå¸Œç                                 â”‚
â”‚    â”œâ”€ ç”Ÿæˆæ£€ç´¢é›†çš„å“ˆå¸Œç                                 â”‚
â”‚    â”œâ”€ è®¡ç®—ç›¸ä¼¼åº¦çŸ©é˜µ                                     â”‚
â”‚    â””â”€ è®¡ç®—MAP@50æŒ‡æ ‡                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ•°æ®åŠ è½½é˜¶æ®µ

### ğŸ“ æ•°æ®é›†ç»“æ„
ä»¥MIRFlickrä¸ºä¾‹ï¼š
```
data/mirflickr/
â”œâ”€ train.pkl      # è®­ç»ƒæ•°æ®
â”œâ”€ query.pkl      # æŸ¥è¯¢æ•°æ®ï¼ˆæµ‹è¯•æ—¶ç”¨å›¾ç‰‡æ‰¾æ–‡å­—æˆ–åä¹‹ï¼‰
â””â”€ retrieval.pkl  # æ£€ç´¢æ•°æ®åº“ï¼ˆè¢«æœç´¢çš„æ•°æ®ï¼‰
```

### ğŸ“¦ æ•°æ®æ ¼å¼
```python
# æ¯ä¸ª.pklæ–‡ä»¶åŒ…å«ï¼š
{
    'image': [N, 512],   # CLIPæå–çš„å›¾åƒç‰¹å¾ï¼Œ512ç»´
    'text': [N, 512],    # CLIPæå–çš„æ–‡æœ¬ç‰¹å¾ï¼Œ512ç»´
    'label': [N, 24]     # 24ä¸ªç±»åˆ«çš„å¤šæ ‡ç­¾ï¼ˆMIRFlickræœ‰24ç±»ï¼‰
}
```

### ğŸ”¢ æ•°æ®åŠ è½½ç¤ºä¾‹
```python
# load_dataset.py
train_images = [4992, 512]  # 4992å¯¹å›¾æ–‡ï¼Œæ¯ä¸ªå›¾åƒ512ç»´
train_texts = [4992, 512]   # å¯¹åº”çš„æ–‡æœ¬ç‰¹å¾
train_labels = [4992, 24]   # å¯¹åº”çš„æ ‡ç­¾

# åˆ›å»ºDataLoader
batch_size = 128
æ¯ä¸ªbatch: 
  - images: [128, 512]
  - texts: [128, 512]
  - labels: [128, 24]

æ€»batchæ•° = 4992 / 128 = 39 batches
```

### âš ï¸ ä¿®æ”¹å‰åï¼šæ•°æ®åŠ è½½å®Œå…¨ç›¸åŒ
```
âœ… æ•°æ®åŠ è½½é˜¶æ®µæ²¡æœ‰ä»»ä½•æ”¹åŠ¨
```

---

## æ¨¡å‹åˆå§‹åŒ–é˜¶æ®µ

### ğŸ—ï¸ æ¨¡å‹æ¶æ„
```python
UCMFHæ¨¡å‹ = {
    # å•æ¨¡æ€å¢å¼º
    ImageTransformer(512 â†’ 512),      # å¢å¼ºå›¾åƒç‰¹å¾å†…éƒ¨å…³ç³»
    TextTransformer(512 â†’ 512),       # å¢å¼ºæ–‡æœ¬ç‰¹å¾å†…éƒ¨å…³ç³»
    
    # è·¨æ¨¡æ€èåˆ
    CrossAttention(512, 512 â†’ 512, 512),  # å›¾æ–‡äº’ç›¸äº¤äº’
    
    # å“ˆå¸Œæ˜ å°„
    ImageMlp(512 â†’ 1024 â†’ 64),        # å›¾åƒ â†’ 64ä½å“ˆå¸Œç 
    TextMlp(512 â†’ 1024 â†’ 64)          # æ–‡æœ¬ â†’ 64ä½å“ˆå¸Œç 
}
```

### ğŸ”§ æŸå¤±å‡½æ•°åˆå§‹åŒ–

#### ä¿®æ”¹å‰ï¼ˆåŸå§‹ç‰ˆæœ¬ï¼‰
```python
# ICMR.py ç¬¬68è¡Œ
from metric import ContrastiveLoss

self.ContrastiveLoss = ContrastiveLoss(
    batch_size=128,
    device='cuda:0',
    temperature=0.5
)

# å†…éƒ¨å‚æ•°
# - æ— æ­£è´Ÿæ ·æœ¬æƒé‡
# - ç®€å•å¹³å‡æ‰€æœ‰æ ·æœ¬æŸå¤±
```

#### ä¿®æ”¹åï¼ˆæ”¹è¿›ç‰ˆæœ¬ï¼‰
```python
# ICMR.py ç¬¬6è¡Œå’Œç¬¬68-69è¡Œ
from metric import ContrastiveLoss, ContrastiveLossBalanced

self.ContrastiveLoss = ContrastiveLossBalanced(
    batch_size=128,
    device='cuda:0',
    temperature=0.5
)
print("âœ… Using ContrastiveLossBalanced - Weighted balanced loss from HashNet")

# å†…éƒ¨å‚æ•°
# ğŸ†• + æ­£æ ·æœ¬mask: [128, 128] å¯¹è§’çº¿ä¸ºTrue
# ğŸ†• + è´Ÿæ ·æœ¬mask: [128, 128] éå¯¹è§’çº¿ä¸ºTrue
# ğŸ†• + è‡ªåŠ¨è®¡ç®—æ­£è´Ÿæ ·æœ¬æƒé‡
```

### âš ï¸ å…³é”®å·®å¼‚
```diff
- åŸå§‹ç‰ˆæœ¬ï¼šåªåˆå§‹åŒ–æŸå¤±å‡½æ•°ï¼Œæ— é¢å¤–å‚æ•°
+ æ”¹è¿›ç‰ˆæœ¬ï¼šåˆå§‹åŒ–æŸå¤±å‡½æ•° + é¢„è®¡ç®—æ­£è´Ÿæ ·æœ¬mask
```

---

## è®­ç»ƒé˜¶æ®µè¯¦è§£

### ğŸ“ é˜¶æ®µ1ï¼šè®­ç»ƒèåˆæ¨¡å— (task=0)

ç›®æ ‡ï¼šå­¦ä¹ é«˜è´¨é‡çš„å®å€¼åµŒå…¥ï¼ˆä¸æ˜¯å“ˆå¸Œç ï¼Œæ˜¯è¿ç»­å€¼ï¼‰

#### å•ä¸ªBatchçš„è®­ç»ƒæµç¨‹

```
è¾“å…¥: ä¸€ä¸ªbatchçš„æ•°æ®
â”œâ”€ images: [128, 512]   # 128å¼ å›¾ç‰‡çš„CLIPç‰¹å¾
â”œâ”€ texts: [128, 512]    # 128æ®µæ–‡å­—çš„CLIPç‰¹å¾
â””â”€ labels: [128, 24]    # å¯¹åº”çš„æ ‡ç­¾ï¼ˆç”¨äºéªŒè¯ï¼Œè®­ç»ƒæ—¶ä¸ç”¨ï¼‰
```

#### ç¬¬1æ­¥ï¼šå‰å‘ä¼ æ’­ï¼ˆä¿®æ”¹å‰åå®Œå…¨ç›¸åŒï¼‰

```python
# å•æ¨¡æ€å¢å¼º
img_enhanced = ImageTransformer(images)      # [128, 512]
text_enhanced = TextTransformer(texts)        # [128, 512]

# è·¨æ¨¡æ€èåˆ
img_embedding, text_embedding = CrossAttention(
    img_enhanced, 
    text_enhanced
)
# img_embedding: [128, 512]  - èåˆåçš„å›¾åƒè¡¨ç¤º
# text_embedding: [128, 512] - èåˆåçš„æ–‡æœ¬è¡¨ç¤º
```

**è¿™ä¸€æ­¥çš„æ„ä¹‰**ï¼š
- `img_embedding[0]` åŒ…å«äº†ç¬¬1å¼ å›¾ç‰‡çš„ä¿¡æ¯ + ä»é…å¯¹æ–‡å­—ä¸­å­¦åˆ°çš„ä¿¡æ¯
- `text_embedding[0]` åŒ…å«äº†ç¬¬1æ®µæ–‡å­—çš„ä¿¡æ¯ + ä»é…å¯¹å›¾ç‰‡ä¸­å­¦åˆ°çš„ä¿¡æ¯

#### ç¬¬2æ­¥ï¼šè®¡ç®—æŸå¤± â­ **è¿™æ˜¯ä¿®æ”¹çš„å…³é”®ï¼**

##### ğŸ”´ ä¿®æ”¹å‰ï¼šåŸå§‹ContrastiveLoss

```python
# trainfusion() ç¬¬207è¡Œ
loss = self.ContrastiveLoss(img_embedding, text_embedding)

# å†…éƒ¨è®¡ç®—è¿‡ç¨‹ï¼š
# ====================
# 1. L2å½’ä¸€åŒ–
z_i = F.normalize(img_embedding, dim=1)   # [128, 512]
z_j = F.normalize(text_embedding, dim=1)  # [128, 512]

# 2. æ‹¼æ¥æˆ [256, 512]
representations = torch.cat([z_i, z_j], dim=0)

# 3. è®¡ç®—256Ã—256çš„ç›¸ä¼¼åº¦çŸ©é˜µ
similarity_matrix = cosine_similarity(
    representations.unsqueeze(1),
    representations.unsqueeze(0)
)  # [256, 256]

# 4. æå–æ­£æ ·æœ¬ï¼ˆå¯¹è§’çº¿åç§»ï¼‰
sim_ij = diagonal(similarity_matrix, offset=128)  # [128]
sim_ji = diagonal(similarity_matrix, offset=-128) # [128]
positives = cat([sim_ij, sim_ji])  # [256]

# 5. è®¡ç®—InfoNCEæŸå¤±ï¼ˆæ— åŠ æƒï¼‰
for i in range(256):
    numerator = exp(positives[i] / temp)
    denominator = sum(exp(similarity_matrix[i, :] / temp))
    loss[i] = -log(numerator / denominator)

# 6. ç®€å•å¹³å‡
final_loss = mean(loss)  # âŒ æ­£è´Ÿæ ·æœ¬ä¸€è§†åŒä»

return final_loss
```

**å…·ä½“æ•°å­—ç¤ºä¾‹**ï¼ˆbatchå†…ç¬¬1ä¸ªæ ·æœ¬ï¼‰ï¼š
```
ç¬¬1å¼ å›¾ç‰‡ vs æ‰€æœ‰256ä¸ªè¡¨ç¤ºï¼ˆ128å›¾+128æ–‡ï¼‰ï¼š

æ­£æ ·æœ¬ï¼š
  - å›¾1 vs æ–‡1ï¼ˆé…å¯¹ï¼‰: ç›¸ä¼¼åº¦ 0.85 âœ… (1ä¸ª)

è´Ÿæ ·æœ¬ï¼š
  - å›¾1 vs æ–‡2-128ï¼ˆä¸é…å¯¹ï¼‰: ç›¸ä¼¼åº¦ 0.1-0.4 âŒ (127ä¸ª)
  - å›¾1 vs å›¾1-128ï¼ˆè‡ªå·±å’Œå…¶ä»–å›¾ï¼‰: ç›¸ä¼¼åº¦ 0.2-0.6 âŒ (128ä¸ª)

æ­£è´Ÿæ¯”ä¾‹ï¼š1 : 255

æŸå¤±è®¡ç®—ï¼š
numerator = exp(0.85/0.5) = 5.47
denominator = 5.47 + sum(exp([0.1~0.6]/0.5)) â‰ˆ 150
loss = -log(5.47/150) = 3.31

é—®é¢˜ï¼šåˆ†æ¯è¢«255ä¸ªè´Ÿæ ·æœ¬ä¸»å¯¼ï¼
```

##### ğŸŸ¢ ä¿®æ”¹åï¼šContrastiveLossBalanced

```python
# trainfusion() ç¬¬207è¡Œï¼ˆä»£ç ç›¸åŒï¼Œä½†è°ƒç”¨çš„å‡½æ•°ä¸åŒï¼‰
loss = self.ContrastiveLoss(img_embedding, text_embedding)

# å†…éƒ¨è®¡ç®—è¿‡ç¨‹ï¼š
# ====================
# 1. L2å½’ä¸€åŒ–ï¼ˆåŒåŸå§‹ï¼‰
z_i = F.normalize(img_embedding, dim=1)  # [128, 512]
z_j = F.normalize(text_embedding, dim=1) # [128, 512]

# 2. è®¡ç®—128Ã—128ç›¸ä¼¼åº¦çŸ©é˜µï¼ˆæ›´ç›´æ¥ï¼‰
similarity_matrix = mm(z_i, z_j.T)  # [128, 128]

# 3. ğŸ†• è®¡ç®—æ­£è´Ÿæ ·æœ¬æ•°é‡
positive_mask = eye(128)      # å¯¹è§’çº¿ [128, 128]
negative_mask = ~positive_mask # éå¯¹è§’çº¿

S1 = positive_mask.sum() = 128       # æ­£æ ·æœ¬æ•°
S0 = negative_mask.sum() = 128Ã—127 = 16,256  # è´Ÿæ ·æœ¬æ•°
S = S1 + S0 = 16,384                # æ€»æ•°

# 4. ğŸ†• è®¡ç®—æƒé‡
w_pos = S / S1 = 16,384 / 128 = 128å€
w_neg = S / S0 = 16,384 / 16,256 â‰ˆ 1.008å€

# 5. è®¡ç®—åŠ æƒæŸå¤±
for i in range(128):
    # æ­£æ ·æœ¬çš„exp
    exp_positive = exp(similarity[i, i] / temp)
    
    # è´Ÿæ ·æœ¬çš„expï¼ˆåŠ æƒï¼‰
    exp_negatives = sum(exp(similarity[i, j!=i] / temp))
    weighted_exp_neg = exp_negatives * w_neg  # ğŸ†• åŠ æƒ
    
    # æ–°çš„åˆ†æ¯
    denominator = exp_positive + weighted_exp_neg
    
    # è®¡ç®—æŸå¤±å¹¶åº”ç”¨æ­£æ ·æœ¬æƒé‡
    loss[i] = -log(exp_positive / denominator) * w_pos  # ğŸ†• å†æ¬¡åŠ æƒ

# 6. è¿”å›å¹³å‡
final_loss = mean(loss)

return final_loss
```

**å…·ä½“æ•°å­—ç¤ºä¾‹**ï¼ˆbatchå†…ç¬¬1ä¸ªæ ·æœ¬ï¼‰ï¼š
```
ç¬¬1å¼ å›¾ç‰‡ vs 128ä¸ªæ–‡æœ¬ï¼š

æ­£æ ·æœ¬ï¼š
  - å›¾1 vs æ–‡1ï¼ˆé…å¯¹ï¼‰: ç›¸ä¼¼åº¦ 0.85 âœ… (1ä¸ª)

è´Ÿæ ·æœ¬ï¼š
  - å›¾1 vs æ–‡2-128ï¼ˆä¸é…å¯¹ï¼‰: ç›¸ä¼¼åº¦ 0.1-0.4 âŒ (127ä¸ª)

æ­£è´Ÿæ¯”ä¾‹ï¼š1 : 127

æƒé‡è®¡ç®—ï¼š
w_pos = 128å€
w_neg = 1.008å€

æŸå¤±è®¡ç®—ï¼ˆåŠ æƒç‰ˆï¼‰ï¼š
numerator = exp(0.85/0.5) = 5.47
denominator_neg = sum(exp([0.1~0.4]/0.5)) â‰ˆ 40
weighted_denominator_neg = 40 Ã— 1.008 = 40.32
denominator = 5.47 + 40.32 = 45.79

intermediate_loss = -log(5.47/45.79) = 2.13
final_loss = 2.13 Ã— 128 = 272.64

å¯¹æ¯”ï¼š
- åŸå§‹æŸå¤±ï¼š3.31
- æ”¹è¿›æŸå¤±ï¼š272.64 (å˜å¤§äº†82å€ï¼)

ä½†è¿™æ˜¯æ­£å¸¸çš„ï¼é‡è¦çš„æ˜¯æ¢¯åº¦æ–¹å‘å’Œæœ€ç»ˆæ•ˆæœã€‚
```

#### ç¬¬3æ­¥ï¼šåå‘ä¼ æ’­ï¼ˆä¿®æ”¹å‰åå®Œå…¨ç›¸åŒï¼‰

```python
# æ¸…ç©ºæ¢¯åº¦
optimizer_Fusion.zero_grad()

# åå‘ä¼ æ’­è®¡ç®—æ¢¯åº¦
loss.backward()

# æ›´æ–°å‚æ•°
optimizer_Fusion.step()
```

**æ¢¯åº¦å½±å“å¯¹æ¯”**ï¼š

```
åŸå§‹æ–¹æ³•ï¼š
âˆ‚loss/âˆ‚img_embedding[0] âˆ (1 - 5.47/150) â‰ˆ 0.964
â†’ æ¢¯åº¦è¾ƒå°ï¼Œå­¦ä¹ è¾ƒæ…¢

æ”¹è¿›æ–¹æ³•ï¼š
âˆ‚loss/âˆ‚img_embedding[0] âˆ 128 Ã— (1 - 5.47/45.79) â‰ˆ 113.2
â†’ æ¢¯åº¦å¤§117å€ï¼å­¦ä¹ æ›´å¿«ï¼Œæ›´å…³æ³¨æ­£æ ·æœ¬
```

#### ç¬¬4æ­¥ï¼šä¸€ä¸ªepochå®Œæˆ

```python
# éå†æ‰€æœ‰39ä¸ªbatches
for batch in train_loader:  # 4992/128 = 39 batches
    forward â†’ loss â†’ backward â†’ update

# è¿”å›è¿™ä¸ªepochçš„æ€»æŸå¤±
return running_loss
```

**ä¸€ä¸ªepochçš„æŸå¤±å¯¹æ¯”**ï¼š
```
åŸå§‹æ–¹æ³•ï¼šrunning_loss â‰ˆ 3.31 Ã— 39 â‰ˆ 129
æ”¹è¿›æ–¹æ³•ï¼šrunning_loss â‰ˆ 272.64 Ã— 39 â‰ˆ 10,633

â— æ”¹è¿›åæŸå¤±å˜å¤§82å€ï¼Œä½†è¿™æ˜¯æ­£å¸¸çš„ï¼
   çœ‹çš„æ˜¯æŸå¤±ä¸‹é™è¶‹åŠ¿ï¼Œä¸æ˜¯ç»å¯¹å€¼ã€‚
```

---

### ğŸ“ é˜¶æ®µ2ï¼šè®­ç»ƒå“ˆå¸Œå‡½æ•° (task=1)

ç›®æ ‡ï¼šå°†512ç»´å®å€¼åµŒå…¥å‹ç¼©æˆ64ä½äºŒè¿›åˆ¶å“ˆå¸Œç 

#### å•ä¸ªBatchçš„è®­ç»ƒæµç¨‹

```
è¾“å…¥: åŒé˜¶æ®µ1
â”œâ”€ images: [128, 512]
â”œâ”€ texts: [128, 512]
â””â”€ labels: [128, 24]
```

#### å®Œæ•´å‰å‘ä¼ æ’­ï¼ˆä¿®æ”¹å‰åå®Œå…¨ç›¸åŒï¼‰

```python
# ç¬¬ä¸€é˜¶æ®µï¼šèåˆï¼ˆåŒä¸Šï¼‰
img_enhanced = ImageTransformer(images)
text_enhanced = TextTransformer(texts)
img_embedding, text_embedding = CrossAttention(img_enhanced, text_enhanced)
# â†’ [128, 512] å®å€¼åµŒå…¥

# ç¬¬äºŒé˜¶æ®µï¼šå“ˆå¸Œæ˜ å°„ï¼ˆæ–°å¢ï¼‰
img_hash = ImageMlp(img_embedding)   # [128, 512] â†’ [128, 64]
text_hash = TextMlp(text_embedding)  # [128, 512] â†’ [128, 64]

# ImageMlpå†…éƒ¨ï¼š
# fc1: 512 â†’ 1024
# relu + dropout
# fc2: 1024 â†’ 64
# L2å½’ä¸€åŒ–: normalize(output)
# ç»“æœï¼š[128, 64] è¿ç»­å€¼ï¼ŒèŒƒå›´çº¦[-1, 1]
```

#### æŸå¤±è®¡ç®—ï¼ˆä¸¤éƒ¨åˆ†æŸå¤±ï¼‰

```python
# æŸå¤±1ï¼šèåˆåµŒå…¥çš„å¯¹æ¯”æŸå¤±
loss1 = ContrastiveLoss(img_embedding, text_embedding)
# [128, 512] vs [128, 512]
# ç¡®ä¿èåˆç‰¹å¾è´¨é‡

# æŸå¤±2ï¼šå“ˆå¸Œç çš„å¯¹æ¯”æŸå¤±ï¼ˆâ­ ä¿®æ”¹çš„åœ°æ–¹ï¼‰
loss2 = ContrastiveLoss(img_hash, text_hash)
# [128, 64] vs [128, 64]
# ç¡®ä¿å“ˆå¸Œç ä¹Ÿç›¸ä¼¼

# æ€»æŸå¤±
loss = loss1 + 0.5 * loss2
```

#### ä¿®æ”¹å‰åçš„æŸå¤±å¯¹æ¯”

##### åŸå§‹æ–¹æ³•
```python
# ä¸¤ä¸ªæŸå¤±éƒ½ç”¨ ContrastiveLossï¼ˆæ— åŠ æƒï¼‰
loss1 = ContrastiveLoss(img_embedding, text_embedding)  # â‰ˆ3.31
loss2 = ContrastiveLoss(img_hash, text_hash)            # â‰ˆ2.85
total_loss = 3.31 + 0.5Ã—2.85 = 4.74
```

##### æ”¹è¿›æ–¹æ³•
```python
# ä¸¤ä¸ªæŸå¤±éƒ½ç”¨ ContrastiveLossBalancedï¼ˆåŠ æƒï¼‰
loss1 = ContrastiveLossBalanced(img_embedding, text_embedding)  # â‰ˆ272.64
loss2 = ContrastiveLossBalanced(img_hash, text_hash)            # â‰ˆ235.12
total_loss = 272.64 + 0.5Ã—235.12 = 390.20

å¯¹æ¯”ï¼š
- åŸå§‹æ€»æŸå¤±ï¼š4.74
- æ”¹è¿›æ€»æŸå¤±ï¼š390.20ï¼ˆå˜å¤§82å€ï¼‰
```

#### åå‘ä¼ æ’­æ›´æ–°3ä¸ªä¼˜åŒ–å™¨

```python
# æ¸…ç©ºæ‰€æœ‰æ¢¯åº¦
optimizer_Fusion.zero_grad()
optimizer_ImageMlp.zero_grad()
optimizer_TextMlp.zero_grad()

# åå‘ä¼ æ’­
loss.backward()

# æ›´æ–°æ‰€æœ‰å‚æ•°
optimizer_Fusion.step()      # æ›´æ–°Transformerå’ŒCrossAttention
optimizer_ImageMlp.step()    # æ›´æ–°ImageMlp
optimizer_TextMlp.step()     # æ›´æ–°TextMlp

# å­¦ä¹ ç‡è°ƒåº¦
scheduler_ImageMlp.step()
scheduler_TextMlp.step()
```

---

## æµ‹è¯•è¯„ä¼°é˜¶æ®µ

### ğŸ“Š è¯„ä¼°æµç¨‹ï¼ˆæ¯10ä¸ªepochæ‰§è¡Œä¸€æ¬¡ï¼‰

#### ç¬¬1æ­¥ï¼šç”Ÿæˆå“ˆå¸Œç 

```python
# å¯¹æŸ¥è¯¢é›†ç”Ÿæˆå“ˆå¸Œç 
query_images: [1000, 512]  # å‡è®¾1000ä¸ªæŸ¥è¯¢æ ·æœ¬
query_texts: [1000, 512]

# å‰å‘ä¼ æ’­ï¼ˆæ— æ¢¯åº¦ï¼‰
with torch.no_grad():
    img_enhanced = ImageTransformer(query_images)
    text_enhanced = TextTransformer(query_texts)
    img_emb, text_emb = CrossAttention(img_enhanced, text_enhanced)
    
    if task == 1:  # å“ˆå¸Œä»»åŠ¡
        img_codes = ImageMlp(img_emb)    # [1000, 64]
        text_codes = TextMlp(text_emb)   # [1000, 64]
        
        # äºŒå€¼åŒ–ï¼ˆç­¾åå‡½æ•°ï¼‰
        img_codes = sign(img_codes)      # å˜æˆ -1 æˆ– +1
        text_codes = sign(text_codes)    # [1000, 64] äºŒè¿›åˆ¶
    elif task == 0:  # å®å€¼ä»»åŠ¡
        img_codes = img_emb              # [1000, 512] è¿ç»­å€¼
        text_codes = text_emb
```

#### ç¬¬2æ­¥ï¼šè®¡ç®—ç›¸ä¼¼åº¦

```python
# å›¾åƒåˆ°æ–‡æœ¬æ£€ç´¢ (I2T)
# query: å›¾åƒå“ˆå¸Œç  [1000, 64]
# database: æ–‡æœ¬å“ˆå¸Œç  [5000, 64]

similarity = query_img @ database_text.T  # [1000, 5000]

# å¯¹äºå“ˆå¸Œç ï¼š
# similarity[i,j] = hammingç›¸ä¼¼åº¦
# = 64 - hamming_distance / 64
# å€¼è¶Šå¤§è¶Šç›¸ä¼¼

# å¯¹äºå®å€¼ï¼š
# similarity[i,j] = ä½™å¼¦ç›¸ä¼¼åº¦
# å€¼è¶Šå¤§è¶Šç›¸ä¼¼
```

#### ç¬¬3æ­¥ï¼šè®¡ç®—MAP@50

```python
# å¯¹äºæ¯ä¸ªæŸ¥è¯¢
for i in range(1000):
    # æ‰¾åˆ°ç›¸ä¼¼åº¦æœ€é«˜çš„50ä¸ªç»“æœ
    top50_indices = argsort(similarity[i])[:50]
    
    # æ£€æŸ¥è¿™50ä¸ªä¸­æœ‰å¤šå°‘æ˜¯çœŸæ­£ç›¸å…³çš„
    # ï¼ˆé€šè¿‡æ¯”è¾ƒæ ‡ç­¾åˆ¤æ–­ï¼‰
    relevant = []
    for j in top50_indices:
        if query_labels[i] å’Œ database_labels[j] æœ‰é‡å :
            relevant.append(j)
    
    # è®¡ç®—å¹³å‡ç²¾åº¦
    AP = average_precision(relevant, top50)
    
# æ‰€æœ‰æŸ¥è¯¢çš„å¹³å‡
MAP = mean(æ‰€æœ‰AP)
```

#### âš ï¸ ä¿®æ”¹å‰åï¼šæµ‹è¯•é˜¶æ®µå®Œå…¨ç›¸åŒ

```
âœ… æµ‹è¯•è¯„ä¼°é˜¶æ®µæ²¡æœ‰ä»»ä½•æ”¹åŠ¨
   åªæ˜¯ä½¿ç”¨è®­ç»ƒå¥½çš„æ¨¡å‹è¿›è¡Œæ¨ç†
   æ”¹è¿›çš„æŸå¤±å‡½æ•°åªå½±å“è®­ç»ƒè¿‡ç¨‹
```

---

## ä¿®æ”¹å‰åå¯¹æ¯”æ€»ç»“

### ğŸ“‹ å®Œæ•´å¯¹æ¯”è¡¨

| é˜¶æ®µ | æ­¥éª¤ | ä¿®æ”¹å‰ | ä¿®æ”¹å | æ˜¯å¦æ”¹å˜ |
|------|------|--------|--------|----------|
| **æ•°æ®åŠ è½½** | è¯»å–pklæ–‡ä»¶ | load_dataset() | load_dataset() | âŒ æ— å˜åŒ– |
| | åˆ›å»ºDataLoader | batch_size=128 | batch_size=128 | âŒ æ— å˜åŒ– |
| **æ¨¡å‹åˆå§‹åŒ–** | å¯¼å…¥æŸå¤±å‡½æ•° | `from metric import ContrastiveLoss` | `from metric import ContrastiveLoss, ContrastiveLossBalanced` | âœ… æ”¹å˜ |
| | å®ä¾‹åŒ–æŸå¤± | `ContrastiveLoss(...)` | `ContrastiveLossBalanced(...)` | âœ… æ”¹å˜ |
| | å…¶ä»–ç»„ä»¶ | ImageTransformer, TextTransformer... | åŒå·¦ | âŒ æ— å˜åŒ– |
| **è®­ç»ƒ-å‰å‘ä¼ æ’­** | å•æ¨¡æ€å¢å¼º | ImageTransformer(img) | åŒå·¦ | âŒ æ— å˜åŒ– |
| | è·¨æ¨¡æ€èåˆ | CrossAttention(...) | åŒå·¦ | âŒ æ— å˜åŒ– |
| | å“ˆå¸Œæ˜ å°„ | ImageMlp(...) | åŒå·¦ | âŒ æ— å˜åŒ– |
| **è®­ç»ƒ-æŸå¤±è®¡ç®—** | è°ƒç”¨æ–¹å¼ | `loss = ContrastiveLoss(...)` | åŒå·¦ | âŒ æ— å˜åŒ– |
| | å†…éƒ¨å®ç° | æ— åŠ æƒï¼Œå¹³å‡æ‰€æœ‰æ ·æœ¬ | ğŸ†• åŠ æƒå¹³è¡¡æ­£è´Ÿæ ·æœ¬ | âœ… **æ ¸å¿ƒæ”¹å˜** |
| | æ­£æ ·æœ¬æƒé‡ | 1å€ | 128å€ | âœ… **æ ¸å¿ƒæ”¹å˜** |
| | è´Ÿæ ·æœ¬æƒé‡ | 1å€ | 1.008å€ | âœ… **æ ¸å¿ƒæ”¹å˜** |
| | æŸå¤±å€¼å¤§å° | çº¦3-5 | çº¦250-400 | âœ… å˜å¤§ï¼ˆæ­£å¸¸ï¼‰ |
| **è®­ç»ƒ-åå‘ä¼ æ’­** | backward() | loss.backward() | åŒå·¦ | âŒ æ— å˜åŒ– |
| | optimizer.step() | æ›´æ–°å‚æ•° | åŒå·¦ | âŒ æ— å˜åŒ– |
| | æ¢¯åº¦å¤§å° | åŸºçº¿ | çº¦128å€ | âœ… å˜å¤§ï¼ˆå¥½äº‹ï¼‰ |
| **æµ‹è¯•è¯„ä¼°** | ç”Ÿæˆå“ˆå¸Œç  | forward + sign | åŒå·¦ | âŒ æ— å˜åŒ– |
| | è®¡ç®—ç›¸ä¼¼åº¦ | query @ db.T | åŒå·¦ | âŒ æ— å˜åŒ– |
| | è®¡ç®—MAP | calculate_top_map() | åŒå·¦ | âŒ æ— å˜åŒ– |
| | é¢„æœŸMAP | åŸºçº¿ï¼ˆå¦‚0.75ï¼‰ | +5~10%ï¼ˆå¦‚0.81ï¼‰ | âœ… æå‡ |

### ğŸ¯ ä¿®æ”¹çš„æœ¬è´¨

**åªæ”¹äº†1ä¸ªåœ°æ–¹**ï¼šæŸå¤±å‡½æ•°çš„å†…éƒ¨å®ç°

**ä½†å½±å“äº†**ï¼š
- âœ… è®­ç»ƒè¿‡ç¨‹ä¸­çš„æ¢¯åº¦åˆ†å¸ƒ
- âœ… æ¨¡å‹å­¦ä¹ çš„é‡ç‚¹ï¼ˆä»"éƒ½ä¸ç›¸ä¼¼"å˜ä¸º"çœŸæ­£ç›¸ä¼¼"ï¼‰
- âœ… æœ€ç»ˆçš„æ£€ç´¢æ€§èƒ½ï¼ˆMAPæå‡ï¼‰

**æ²¡æœ‰æ”¹å˜**ï¼š
- âŒ æ•°æ®åŠ è½½æµç¨‹
- âŒ æ¨¡å‹æ¶æ„
- âŒ å‰å‘ä¼ æ’­é€»è¾‘
- âŒ ä¼˜åŒ–å™¨è®¾ç½®
- âŒ æµ‹è¯•è¯„ä¼°æµç¨‹

---

## ğŸ”¬ å…·ä½“è®­ç»ƒè¿‡ç¨‹ç¤ºä¾‹

### åœºæ™¯ï¼šè®­ç»ƒ1ä¸ªepochï¼ˆé˜¶æ®µ2ï¼Œå“ˆå¸Œä»»åŠ¡ï¼‰

```
æ•°æ®é›†ï¼šMIRFlickr, 4992å¯¹å›¾æ–‡, batch_size=128
æ€»batchesï¼š39

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Epoch 1å¼€å§‹
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Batch 1/39:
  è¾“å…¥: images[128,512], texts[128,512]
  
  å‰å‘ä¼ æ’­:
    img_enhanced â† ImageTransformer(images)
    text_enhanced â† TextTransformer(texts)
    img_emb, text_emb â† CrossAttention(...)
    img_hash â† ImageMlp(img_emb)  # [128,64]
    text_hash â† TextMlp(text_emb) # [128,64]
  
  æŸå¤±è®¡ç®—:
    ã€åŸå§‹æ–¹æ³•ã€‘
    loss1 = ContrastiveLoss(img_emb, text_emb) = 3.24
    loss2 = ContrastiveLoss(img_hash, text_hash) = 2.79
    total = 3.24 + 0.5Ã—2.79 = 4.64
    
    ã€æ”¹è¿›æ–¹æ³•ã€‘
    loss1 = ContrastiveLossBalanced(img_emb, text_emb) = 268.45
    loss2 = ContrastiveLossBalanced(img_hash, text_hash) = 231.67
    total = 268.45 + 0.5Ã—231.67 = 384.28
  
  åå‘ä¼ æ’­:
    æ¸…ç©ºæ¢¯åº¦ â†’ backward() â†’ æ›´æ–°å‚æ•°
    
  è¿›åº¦: [1/39] Loss: 4.64 (åŸå§‹) / 384.28 (æ”¹è¿›)

Batch 2/39:
  ... (é‡å¤ä¸Šè¿°è¿‡ç¨‹)
  è¿›åº¦: [2/39] Loss: 4.51 / 376.12

... (æŒç»­åˆ°39ä¸ªbatch)

Batch 39/39:
  è¿›åº¦: [39/39] Loss: 3.87 / 312.45

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Epoch 1å®Œæˆ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

æ€»æŸå¤±:
  åŸå§‹æ–¹æ³•: 165.32 (å¹³å‡æ¯batch 4.24)
  æ”¹è¿›æ–¹æ³•: 13,754.18 (å¹³å‡æ¯batch 352.67)

è§‚å¯Ÿ:
  âœ… æ”¹è¿›åæŸå¤±å€¼å¤§å¾—å¤šï¼ˆ83å€ï¼‰
  âœ… ä½†éƒ½åœ¨ç¨³å®šä¸‹é™
  âœ… è¿™æ˜¯é¢„æœŸè¡Œä¸ºï¼
```

### è®­ç»ƒ10ä¸ªepochåçš„å¯¹æ¯”

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æµ‹è¯•è¯„ä¼°ï¼ˆç¬¬10ä¸ªepochåï¼‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ç”ŸæˆæŸ¥è¯¢é›†å“ˆå¸Œç : 1000ä¸ªæ ·æœ¬
ç”Ÿæˆæ£€ç´¢é›†å“ˆå¸Œç : 5000ä¸ªæ ·æœ¬

è®¡ç®—ç›¸ä¼¼åº¦çŸ©é˜µ: [1000, 5000]

è®¡ç®—MAP@50:

ã€åŸå§‹æ–¹æ³•ã€‘
  I2T MAP@50: 0.7453
  T2I MAP@50: 0.7381
  å¹³å‡MAP: 0.7417

ã€æ”¹è¿›æ–¹æ³•ã€‘
  I2T MAP@50: 0.8124  (+9.0% âœ…)
  T2I MAP@50: 0.8057  (+9.2% âœ…)
  å¹³å‡MAP: 0.8091     (+9.1% âœ…)

å·®å¼‚åˆ†æ:
  æ”¹è¿›æ–¹æ³•é€šè¿‡åŠ æƒå¹³è¡¡ç­–ç•¥ï¼Œå¼ºåˆ¶æ¨¡å‹å­¦ä¹ 
  "ä»€ä¹ˆæ˜¯çœŸæ­£ç›¸ä¼¼çš„"ï¼Œå› æ­¤æ£€ç´¢å‡†ç¡®ç‡æå‡ã€‚
```

---

## ğŸ’¡ å…³é”®è¦ç‚¹æ€»ç»“

### 1. æ”¹åŠ¨æœ€å°åŒ–
```
åªæ”¹äº†2è¡Œä»£ç ï¼š
  - ç¬¬6è¡Œï¼šå¯¼å…¥æ–°æŸå¤±å‡½æ•°
  - ç¬¬68è¡Œï¼šä½¿ç”¨æ–°æŸå¤±å‡½æ•°
```

### 2. å½±å“æœ€å¤§åŒ–
```
è™½ç„¶åªæ”¹2è¡Œï¼Œä½†å½±å“ï¼š
  âœ… è®­ç»ƒç›®æ ‡ï¼ˆæ›´å…³æ³¨æ­£æ ·æœ¬ï¼‰
  âœ… æ¢¯åº¦åˆ†å¸ƒï¼ˆæ­£æ ·æœ¬æ¢¯åº¦å¤§128å€ï¼‰
  âœ… æœ€ç»ˆæ€§èƒ½ï¼ˆMAPæå‡5-10%ï¼‰
```

### 3. å‘åå…¼å®¹
```
éšæ—¶å¯ä»¥åˆ‡æ¢å›åŸå§‹æ–¹æ³•ï¼š
  åªéœ€æ”¹å›ï¼š
  self.ContrastiveLoss = ContrastiveLoss(...)
```

### 4. æŸå¤±å€¼å˜åŒ–æ˜¯æ­£å¸¸çš„
```
âŒ é”™è¯¯ç†è§£ï¼šæŸå¤±å˜å¤§äº†ï¼Œæ¨¡å‹å˜å·®äº†
âœ… æ­£ç¡®ç†è§£ï¼šæŸå¤±å€¼å°ºåº¦æ”¹å˜äº†ï¼Œä½†ä¼˜åŒ–æ–¹å‘æ›´å¥½

ç±»æ¯”ï¼š
  åŸå§‹ï¼šç”¨ç±³å°ºé‡èº«é«˜ï¼ˆ1.75ç±³ï¼‰
  æ”¹è¿›ï¼šç”¨å˜ç±³é‡èº«é«˜ï¼ˆ175å˜ç±³ï¼‰
  æ•°å­—å˜å¤§ï¼Œä½†éƒ½æ˜¯åŒä¸€ä¸ªèº«é«˜ï¼
```

### 5. å®é™…ä½¿ç”¨å»ºè®®
```
é˜¶æ®µ1ï¼ˆå®å€¼è®­ç»ƒï¼‰ï¼š
  epochs: 100
  é¢„æœŸæŸå¤±èŒƒå›´ï¼ˆåŸå§‹ï¼‰ï¼š5-2
  é¢„æœŸæŸå¤±èŒƒå›´ï¼ˆæ”¹è¿›ï¼‰ï¼š400-150

é˜¶æ®µ2ï¼ˆå“ˆå¸Œè®­ç»ƒï¼‰ï¼š
  epochs: 300
  é¢„æœŸæŸå¤±èŒƒå›´ï¼ˆåŸå§‹ï¼‰ï¼š6-3
  é¢„æœŸæŸå¤±èŒƒå›´ï¼ˆæ”¹è¿›ï¼‰ï¼š500-200

å…³æ³¨ç‚¹ï¼š
  âœ… æŸå¤±æ˜¯å¦ä¸‹é™
  âœ… MAPæ˜¯å¦æå‡
  âŒ ä¸è¦æ¯”è¾ƒæŸå¤±çš„ç»å¯¹å€¼å¤§å°
```

---

å¸Œæœ›è¿™ä¸ªè¯¦ç»†çš„æµç¨‹å¯¹æ¯”å¸®ä½ å®Œå…¨ç†è§£äº†ä¿®æ”¹å‰åçš„åŒºåˆ«ï¼ğŸ‰

æœ‰ä»»ä½•ç»†èŠ‚ä¸æ¸…æ¥šçš„ï¼Œéšæ—¶é—®æˆ‘ï¼ğŸ˜Š
